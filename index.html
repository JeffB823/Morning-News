<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Morning News – Executive Dashboard</title>
  <meta name="color-scheme" content="light dark">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root { 
      --bg: #0c0c0f; --surface: rgba(255,255,255,0.03); --surface-hover: rgba(255,255,255,0.08); --text: #f8fafc; --muted: #94a3b8; 
      --accent: #00d4ff; --accent-glow: #00d4ff33; --purple: #8b5cf6; --gold: #fbbf24; --emerald: #10b981; 
      --border: rgba(255,255,255,0.06); --shadow: 0 20px 40px rgba(0,0,0,0.4); --glow: 0 0 30px var(--accent-glow);
    }
    :root:not(.dark) { 
      --bg: #fafbfc; --surface: rgba(255,255,255,0.95); --surface-hover: rgba(255,255,255,1); --text: #0f172a; --muted: #64748b; 
      --border: rgba(15,23,42,0.08); --shadow: 0 20px 40px rgba(15,23,42,0.15); --glow: 0 0 30px rgba(0,212,255,0.2);
    }
    
    * { font-family: 'Inter', sans-serif; }
    body { 
      color: var(--text); 
      background: 
        radial-gradient(circle at 20% 20%, var(--accent-glow) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, #8b5cf633 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, #fbbf2433 0%, transparent 50%),
        var(--bg);
      min-height: 100vh; position: relative;
    }
    body::before {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -1;
      background: 
        linear-gradient(135deg, transparent 25%, rgba(0,212,255,0.02) 25%, rgba(0,212,255,0.02) 50%, transparent 50%, transparent 75%, rgba(139,92,246,0.02) 75%),
        linear-gradient(45deg, transparent 25%, rgba(251,191,36,0.02) 25%, rgba(251,191,36,0.02) 50%, transparent 50%);
      background-size: 60px 60px, 40px 40px;
      animation: float 20s ease-in-out infinite;
    }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    @keyframes glow { 0%, 100% { box-shadow: var(--shadow), var(--glow); } 50% { box-shadow: var(--shadow), 0 0 40px var(--accent-glow); } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    
    .glass { 
      background: var(--surface); backdrop-filter: blur(20px) saturate(180%); 
      border: 1px solid var(--border); border-radius: 24px; box-shadow: var(--shadow); 
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .glass:hover { background: var(--surface-hover); transform: translateY(-2px); animation: glow 2s ease-in-out infinite; }
    .glass-lg { border-radius: 32px; }
    
    .chip { 
      position: relative; border-radius: 20px; padding: 12px 24px; border: 1px solid var(--border);
      background: var(--surface); backdrop-filter: blur(12px); transition: all 0.3s ease;
      font-weight: 500; cursor: pointer; overflow: hidden;
    }
    .chip::before { content: ""; position: absolute; inset: 0; background: linear-gradient(135deg, var(--accent), var(--purple)); opacity: 0; transition: opacity 0.3s; border-radius: inherit; }
    .chip:hover { transform: translateY(-2px); box-shadow: var(--glow); }
    .chip:hover::before { opacity: 0.1; }
    .chip.active { 
      background: linear-gradient(135deg, var(--accent), var(--purple)); color: #000; font-weight: 600;
      box-shadow: var(--glow); animation: glow 3s ease-in-out infinite;
    }
    
    .brand { 
      background: linear-gradient(135deg, var(--accent), var(--purple), var(--gold)); 
      -webkit-background-clip: text; background-clip: text; color: transparent; 
      font-weight: 700; letter-spacing: -0.02em;
    }
    
    .btn { 
      padding: 12px 16px; border: 1px solid var(--border); border-radius: 16px; 
      background: var(--surface); color: var(--text); cursor: pointer; font-weight: 500;
      backdrop-filter: blur(12px); transition: all 0.3s ease; position: relative; overflow: hidden;
    }
    .btn::before { content: ""; position: absolute; inset: 0; background: linear-gradient(135deg, var(--accent)22, var(--purple)22); opacity: 0; transition: opacity 0.3s; }
    .btn:hover { transform: translateY(-1px); box-shadow: var(--glow); }
    .btn:hover::before { opacity: 1; }
    .btn:active { transform: translateY(0); }
    
    .input { 
      background: var(--surface); border: 1px solid var(--border); color: var(--text); 
      border-radius: 16px; padding: 16px 20px; outline: none; backdrop-filter: blur(12px);
      transition: all 0.3s ease; font-weight: 400;
    }
    .input:focus { 
      border-color: var(--accent); box-shadow: var(--glow); 
      background: var(--surface-hover); transform: translateY(-1px);
    }
    .input::placeholder { color: var(--muted); }
    
    .card { 
      background: var(--surface); border: 1px solid var(--border); border-radius: 24px; 
      backdrop-filter: blur(20px) saturate(180%); box-shadow: var(--shadow); 
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); animation: slideIn 0.6s ease;
      position: relative; overflow: hidden;
    }
    .card::before { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, var(--accent), transparent); }
    .card:hover { transform: translateY(-4px); box-shadow: var(--shadow), var(--glow); }
    
    .news-item { 
      background: var(--surface); border: 1px solid var(--border); border-radius: 20px;
      backdrop-filter: blur(16px); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative; overflow: hidden;
    }
    .news-item::before { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--emerald), var(--accent), var(--purple)); transform: scaleX(0); transition: transform 0.3s; }
    .news-item:hover { transform: translateY(-3px); box-shadow: var(--glow); }
    .news-item:hover::before { transform: scaleX(1); }
    
    .weather-display { 
      background: linear-gradient(135deg, var(--accent)11, var(--purple)11); 
      border-radius: 20px; padding: 24px; position: relative; overflow: hidden;
    }
    .weather-display::before { content: ""; position: absolute; inset: 0; background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.02) 50%, transparent 70%); animation: shimmer 3s ease-in-out infinite; }
    
    .quote-display { 
      background: linear-gradient(135deg, var(--purple)11, var(--gold)11); 
      border-radius: 20px; padding: 24px; position: relative;
    }
    
    .skeleton { 
      background: linear-gradient(90deg, var(--surface) 25%, var(--surface-hover) 50%, var(--surface) 75%);
      background-size: 200% 100%; animation: shimmer 1.5s infinite;
    }
    
    .ticker-glow { box-shadow: inset 0 1px 0 rgba(255,255,255,0.1), 0 4px 20px var(--accent-glow); }
    
    dialog { 
      background: var(--surface); border: 1px solid var(--border); color: var(--text); 
      border-radius: 32px; backdrop-filter: blur(24px) saturate(180%); box-shadow: var(--shadow), var(--glow);
      animation: slideIn 0.4s ease;
    }
    dialog::backdrop { background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
    
    .status-indicator { 
      display: inline-block; width: 8px; height: 8px; border-radius: 50%; 
      background: var(--emerald); box-shadow: 0 0 8px var(--emerald); 
      animation: pulse 2s ease-in-out infinite;
    }
    
    .premium-scroll { scrollbar-width: thin; scrollbar-color: var(--accent) transparent; }
    .premium-scroll::-webkit-scrollbar { width: 6px; }
    .premium-scroll::-webkit-scrollbar-track { background: transparent; }
    .premium-scroll::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }
  </style>
</head>
<body class="h-full">
  <header class="sticky top-0 z-50 glass">
    <div class="mx-auto max-w-7xl px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-6">
          <div class="text-2xl font-bold brand">NEXUS</div>
          <div class="hidden md:flex items-center gap-1 text-sm font-medium" style="color:var(--muted)">
            <div class="status-indicator"></div>
            LIVE INTELLIGENCE
          </div>
        </div>
        <div class="flex items-center gap-4">
          <select id="density" class="input text-sm font-medium">
            <option value="comfy">Executive</option>
            <option value="compact">Compact</option>
          </select>
          <label class="flex items-center gap-2 text-sm font-medium">
            <input id="private" type="checkbox" class="w-4 h-4 accent-cyan-400">
            <span class="hidden sm:inline" style="color:var(--muted)">Stealth</span>
          </label>
          <button id="theme" class="btn">🌓</button>
        </div>
      </div>
      <div class="mt-4">
        <input id="search" type="search" placeholder="Search intelligence feeds (/)" 
               class="w-full input text-lg font-medium">
      </div>
    </div>
    <div class="border-t ticker-glow" style="border-color:var(--border)">
      <div class="mx-auto max-w-7xl">
        <div id="tickerContainer" class="relative">
          <div id="tickerFallback" class="px-6 py-3 text-sm font-medium brand overflow-hidden whitespace-nowrap">
            <div class="inline-block animate-pulse">⚡ LIVE MARKETS ⚡ S&P 500 • DOW • NASDAQ • FTSE • DAX • NIKKEI • OIL • GOLD • BTC</div>
          </div>
          <div id="tradingview-widget" class="hidden"></div>
        </div>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-6 py-8">
    <section class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
      <div class="card p-6">
        <div class="flex items-center justify-between mb-4">
          <div class="text-lg font-semibold flex items-center gap-2">
            🌍 <span>Climate Intel</span>
          </div>
          <button id="setLocation" class="btn text-sm">Configure</button>
        </div>
        <div id="weather" class="weather-display text-center">
          <div class="text-sm font-medium" style="color:var(--muted)">Getting your location...</div>
        </div>
      </div>
      
      <div class="card lg:col-span-3 p-6">
        <div class="flex items-center justify-between mb-4">
          <div class="text-lg font-semibold flex items-center gap-2">
            💎 <span>Executive Wisdom</span>
          </div>
          <div class="text-xs font-medium px-3 py-1 rounded-full" style="background:var(--accent-glow); color:var(--accent)">CURATED</div>
        </div>
        <div class="quote-display">
          <blockquote id="quote" class="text-xl font-medium leading-relaxed"></blockquote>
          <figcaption id="quoteBy" class="mt-4 text-sm font-medium" style="color:var(--muted)"></figcaption>
        </div>
      </div>
    </section>

    <nav class="mb-8">
      <div id="chips" class="flex flex-wrap gap-3 justify-center"></div>
    </nav>

    <section>
      <div class="flex items-center justify-between mb-6">
        <div id="status" class="flex items-center gap-2 text-sm font-medium" style="color:var(--muted)">
          <div class="status-indicator"></div>
          <span>Processing feeds...</span>
        </div>
        <div class="flex items-center gap-2 text-xs font-medium" style="color:var(--muted)">
          <span>⌨️ Shortcuts:</span>
          <kbd class="px-2 py-1 rounded bg-opacity-50" style="background:var(--surface); border:1px solid var(--border)">/</kbd>
          <kbd class="px-2 py-1 rounded bg-opacity-50" style="background:var(--surface); border:1px solid var(--border)">R</kbd>
          <kbd class="px-2 py-1 rounded bg-opacity-50" style="background:var(--surface); border:1px solid var(--border)">1-5</kbd>
        </div>
      </div>
      
      <div id="news" class="premium-scroll space-y-4 max-h-screen overflow-y-auto"></div>
    </section>
  </main>

  <dialog id="reader" class="w-full max-w-5xl p-0 glass-lg">
    <div class="flex items-center justify-between px-8 py-6" style="border-bottom:1px solid var(--border)">
      <div id="readerTitle" class="text-xl font-semibold">Document Analyzer</div>
      <div class="flex items-center gap-3">
        <button id="fontUp" class="btn">A+</button>
        <button id="fontDown" class="btn">A-</button>
        <button id="speak" class="btn">🔊 Narrate</button>
        <button id="closeReader" class="btn">✕</button>
      </div>
    </div>
    <div id="readerBody" class="p-8 premium-scroll max-h-96 overflow-y-auto"></div>
    <div class="px-8 py-4 text-right">
      <a id="readerOpen" target="_blank" class="text-sm font-medium underline hover:no-underline" style="color:var(--accent)">View Source →</a>
    </div>
  </dialog>

  <script>
    const $ = s => document.querySelector(s);
    const store = {
      get: (k, d) => { try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d; } },
      set: (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} }
    };

    const state = {
      sections: ["Top Stories", "National News", "Columbus News", "Home Lending", "AI"],
      current: "Top Stories",
      density: store.get('density', 'comfy'),
      private: store.get('private', false),
      location: store.get('location', ''),
      fontSize: store.get('fontSize', 1.1)
    };

    const feeds = {
      "Top Stories": [
        "https://feeds.reuters.com/reuters/topNews",
        "https://feeds.npr.org/1001/rss.xml", 
        "http://feeds.bbci.co.uk/news/rss.xml",
        "https://rss.cnn.com/rss/edition.rss"
      ],
      "National News": [
        "https://feeds.npr.org/1003/rss.xml",
        "https://rss.nytimes.com/services/xml/rss/nyt/US.xml",
        "https://www.washingtonpost.com/rss/national/",
        "https://feeds.usatoday.com/usatoday-NewsTopStories"
      ],
      "Columbus News": [
        "https://www.dispatch.com/feeds/news?x=1",
        "https://radio.wosu.org/rss.xml",
        "https://www.columbusunderground.com/rss/",
        "https://www.cleveland.com/arc/outboundfeeds/rss/?outputType=xml"
      ],
      "Home Lending": [
        "https://www.mortgagenewsdaily.com/rss",
        "https://newslink.mba.org/feed/",
        "https://www.housingwire.com/rss",
        "https://www.inman.com/feed/"
      ],
      "AI": [
        "https://openai.com/blog/rss",
        "https://ai.googleblog.com/feeds/posts/default",
        "https://www.theverge.com/rss/index.xml",
        "https://techcrunch.com/category/artificial-intelligence/feed/"
      ]
    };

    const quotes = [
      { text: "The future belongs to those who understand that the only constant is change.", by: "Jeff Bezos" },
      { text: "Innovation distinguishes between a leader and a follower.", by: "Steve Jobs" },
      { text: "Your most unhappy customers are your greatest source of learning.", by: "Bill Gates" },
      { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", by: "Winston Churchill" },
      { text: "The way to get started is to quit talking and begin doing.", by: "Walt Disney" }
    ];

    function setTheme(dark) {
      const isDark = dark ?? !document.documentElement.classList.contains('dark');
      document.documentElement.classList.toggle('dark', isDark);
      store.set('theme', isDark);
      setTimeout(() => loadTradingView(), 100);
    }

    function loadTradingView() {
      const container = $('#tradingview-widget');
      const fallback = $('#tickerFallback');
      
      container.innerHTML = '';
      container.classList.add('hidden');
      fallback.style.display = 'block';
      
      const script = document.createElement('script');
      script.src = "https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js";
      script.async = true;
      script.innerHTML = JSON.stringify({
        symbols: [
          {proName: "FOREXCOM:SPXUSD", title: "S&P 500"},
          {proName: "DJI", title: "Dow Jones"},
          {proName: "NASDAQ:IXIC", title: "Nasdaq"},
          {proName: "CAPITALCOM:UK100", title: "FTSE 100"},
          {proName: "XETR:DAX", title: "DAX"},
          {proName: "TVC:NI225", title: "Nikkei"},
          {proName: "TVC:USOIL", title: "Crude Oil"},
          {proName: "TVC:GOLD", title: "Gold"},
          {proName: "BITSTAMP:BTCUSD", title: "Bitcoin"}
        ],
        showSymbolLogo: true,
        isTransparent: true,
        colorTheme: document.documentElement.classList.contains('dark') ? "dark" : "light",
        displayMode: "adaptive",
        locale: "en"
      });
      
      container.appendChild(script);
      
      setTimeout(() => {
        if (container.querySelector('iframe')) {
          container.classList.remove('hidden');
          fallback.style.display = 'none';
        }
      }, 3000);
    }

    function renderChips() {
      $('#chips').innerHTML = state.sections.map(s => 
        `<button class="chip ${s === state.current ? 'active' : ''}" onclick="selectSection('${s}')">${s}</button>`
      ).join('');
    }

    function selectSection(section) {
      state.current = section;
      renderChips();
      loadNews();
    }

    async function getLocationWeather() {
      if (!navigator.geolocation) {
        $('#weather').innerHTML = '<div class="text-red-400 text-sm font-medium">⚠️ Geolocation not supported</div>';
        return;
      }
      
      navigator.geolocation.getCurrentPosition(async (position) => {
        try {
          const {latitude: lat, longitude: lon} = position.coords;
          // Get city name from coordinates
          const geo = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`).then(r => r.json());
          const city = geo.city || geo.locality || 'Unknown Location';
          
          // Get weather data
          const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit`).then(r => r.json());
          const temp = Math.round(w.current.temperature_2m);
          const hi = Math.round(w.daily.temperature_2m_max[0]);
          const lo = Math.round(w.daily.temperature_2m_min[0]);
          
          state.location = city;
          store.set('location', city);
          
          $('#weather').innerHTML = `
            <div class="text-sm font-medium mb-2" style="color:var(--muted)">${city}</div>
            <div class="text-4xl font-bold brand mb-2">${temp}°F</div>
            <div class="text-xs font-medium" style="color:var(--muted)">Range: ${lo}°F → ${hi}°F</div>
          `;
        } catch (e) {
          $('#weather').innerHTML = '<div class="text-red-400 text-sm font-medium">⚠️ Weather data unavailable</div>';
        }
      }, () => {
        $('#weather').innerHTML = '<div class="text-sm font-medium" style="color:var(--muted)">Location access denied. <br><button onclick="promptLocation()" class="text-cyan-400 underline">Enter manually</button></div>';
      });
    }

    async function promptLocation() {
      const input = prompt('🌍 Enter your city or ZIP code:', state.location);
      if (!input) return;
      
      $('#weather').innerHTML = '<div class="text-sm font-medium" style="color:var(--muted)">Loading weather...</div>';
      
      try {
        let query = input.trim();
        let cityName = query;
        
        // If it's a ZIP code, get city name first
        if (/^\d{5}(-\d{4})?$/.test(query)) {
          const zipData = await fetch(`https://api.zippopotam.us/us/${query.split('-')[0]}`).then(r => r.json());
          cityName = `${zipData.places[0]['place name']}, ${zipData.places[0]['state abbreviation']}`;
          query = cityName;
        }
        
        // Get coordinates for the location
        const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1&format=json`).then(r => r.json());
        if (!geo.results?.[0]) throw new Error('Location not found');
        
        const {latitude: lat, longitude: lon} = geo.results[0];
        
        // Get weather data
        const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m&daily=temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit`).then(r => r.json());
        const temp = Math.round(w.current.temperature_2m);
        const hi = Math.round(w.daily.temperature_2m_max[0]);
        const lo = Math.round(w.daily.temperature_2m_min[0]);
        
        state.location = cityName;
        store.set('location', cityName);
        
        $('#weather').innerHTML = `
          <div class="text-sm font-medium mb-2" style="color:var(--muted)">${cityName}</div>
          <div class="text-4xl font-bold brand mb-2">${temp}°F</div>
          <div class="text-xs font-medium" style="color:var(--muted)">Range: ${lo}°F → ${hi}°F</div>
        `;
      } catch (e) {
        $('#weather').innerHTML = '<div class="text-red-400 text-sm font-medium">⚠️ Invalid location or weather unavailable</div>';
      }
    }

    async function loadWeather() {
      if (state.location) {
        promptLocation();
      } else {
        getLocationWeather();
      }
    }

    function loadQuote() {
      const q = quotes[Math.floor(Math.random() * quotes.length)];
      $('#quote').textContent = `"${q.text}"`;
      $('#quoteBy').textContent = `— ${q.by}`;
    }

    function parseRSS(xml) {
      const doc = new DOMParser().parseFromString(xml, "application/xml");
      return [...doc.querySelectorAll('item, entry')].map(item => ({
        title: item.querySelector('title')?.textContent?.trim() || 'Classified',
        link: item.querySelector('link')?.textContent?.trim() || item.querySelector('link')?.getAttribute('href'),
        description: item.querySelector('description, summary')?.textContent || '',
        pubDate: item.querySelector('pubDate, updated')?.textContent
      })).filter(item => item.link);
    }

    async function loadNews() {
      $('#status').innerHTML = '<div class="status-indicator"></div><span>Processing intelligence feeds...</span>';
      $('#news').innerHTML = Array(8).fill().map((_, i) => 
        `<div class="news-item p-6" style="animation-delay:${i*0.1}s">
          <div class="skeleton h-6 w-3/4 rounded-lg mb-3"></div>
          <div class="skeleton h-4 w-full rounded mb-2"></div>
          <div class="skeleton h-4 w-2/3 rounded"></div>
         </div>`
      ).join('');

      try {
        const urls = feeds[state.current] || [];
        let items = [];
        
        for (const url of urls.slice(0, 4)) {
          try {
            const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
            const xml = await fetch(proxy).then(r => r.text());
            items.push(...parseRSS(xml));
          } catch {}
        }

        const query = $('#search').value.toLowerCase();
        const filtered = query ? items.filter(item => 
          (item.title + ' ' + item.description).toLowerCase().includes(query)
        ) : items;

        $('#news').innerHTML = filtered.slice(0, 24).map((item, i) => `
          <article class="news-item hover:shadow-2xl transition-all duration-300" style="animation-delay:${i*0.05}s">
            <a href="${item.link}" target="_blank" class="block p-6">
              <div class="flex items-start gap-4">
                <div class="w-16 h-16 rounded-2xl overflow-hidden" style="background:linear-gradient(135deg,var(--accent)22,var(--purple)22)">
                  <img class="w-full h-full object-cover transition-transform duration-300 hover:scale-110" 
                       loading="lazy" alt="thumbnail"
                       src="https://www.google.com/s2/favicons?sz=64&domain=${new URL(item.link).hostname}"
                       onerror="this.style.display='none'">
                </div>
                <div class="flex-1 min-w-0">
                  <div class="text-xs font-semibold mb-2 px-2 py-1 rounded-full inline-block" 
                       style="background:var(--accent-glow); color:var(--accent)">
                    ${new URL(item.link).hostname.replace(/^www\./, '').toUpperCase()}
                  </div>
                  <h3 class="font-semibold text-lg leading-tight mb-2 hover:text-cyan-400 transition-colors">
                    ${item.title}
                  </h3>
                  <p class="text-sm leading-relaxed mb-4" style="color:var(--muted)">
                    ${item.description.replace(/<[^>]+>/g, '').slice(0, 200)}${item.description.length > 200 ? '...' : ''}
                  </p>
                  <div class="flex items-center gap-4 text-xs font-medium" style="color:var(--muted)">
                    <button class="hover:text-cyan-400 transition-colors flex items-center gap-1" 
                            onclick="event.preventDefault(); openReader('${item.title.replace(/'/g, "\\'")}', '${item.link}')">
                      🔊 Analyze
                    </button>
                    <button class="hover:text-purple-400 transition-colors flex items-center gap-1" 
                            onclick="event.preventDefault(); speak('${item.title.replace(/'/g, "\\'")}')">[🎧] Audio
                    </button>
                    <span>${new Date(item.pubDate || Date.now()).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})}</span>
                  </div>
                </div>
              </div>
            </a>
          </article>
        `).join('');
        
        $('#status').innerHTML = `<div class="status-indicator"></div><span>Intelligence updated • ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>`;
      } catch {
        $('#status').innerHTML = '<div class="w-2 h-2 rounded-full bg-red-400"></div><span>Feed processing error</span>';
      }
    }

    async function openReader(title, url) {
      $('#readerTitle').textContent = title;
      $('#readerBody').innerHTML = '<div class="text-center py-8 font-medium" style="color:var(--muted)">🔍 Analyzing document...</div>';
      $('#readerOpen').href = url;
      $('#reader').showModal();
      
      try {
        const text = await fetch(`https://r.jina.ai/${url}`).then(r => r.text());
        $('#readerBody').innerHTML = `<div style="white-space:pre-wrap;font-size:${state.fontSize}rem;line-height:1.6">${text.replace(/[<>]/g, m => ({'<': '&lt;', '>': '&gt;'}[m]))}</div>`;
      } catch {
        $('#readerBody').innerHTML = '<div class="text-red-400 text-center py-8">⚠️ Unable to process document</div>';
      }
    }

    function speak(text) {
      if (!window.speechSynthesis) { alert('🔊 Audio synthesis not supported'); return; }
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 0.9; utterance.pitch = 1; utterance.volume = 0.8;
      window.speechSynthesis.speak(utterance);
    }

    // Event Handlers - Consolidated and optimized
    const handlers = {
      '#theme': () => setTheme(),
      '#density': e => { state.density = e.target.value; store.set('density', state.density); },
      '#private': e => { state.private = e.target.checked; store.set('private', state.private); },
      '#search': loadNews,
      '#setLocation': promptLocation,
      '#closeReader': () => $('#reader').close(),
      '#speak': () => speak($('#readerTitle').textContent + '. ' + $('#readerBody').textContent.slice(0, 2000)),
      '#fontUp': () => { 
        state.fontSize = Math.min(1.8, state.fontSize + 0.1); 
        store.set('fontSize', state.fontSize); 
        const body = $('#readerBody div');
        if (body) body.style.fontSize = state.fontSize + 'rem';
      },
      '#fontDown': () => { 
        state.fontSize = Math.max(0.9, state.fontSize - 0.1); 
        store.set('fontSize', state.fontSize); 
        const body = $('#readerBody div');
        if (body) body.style.fontSize = state.fontSize + 'rem';
      }
    };

    Object.entries(handlers).forEach(([selector, handler]) => {
      const el = $(selector);
      if (el) {
        if (selector === '#search') el.oninput = handler;
        else if (selector === '#density' || selector === '#private') el.onchange = handler;
        else el.onclick = handler;
      }
    });

    // Keyboard shortcuts - Optimized
    document.onkeydown = e => {
      const actions = {
        '/': () => { e.preventDefault(); $('#search').focus(); $('#search').select(); },
        't': () => { e.preventDefault(); setTheme(); },
        'r': () => { e.preventDefault(); loadNews(); },
        'Escape': () => { if ($('#reader').open) $('#reader').close(); }
      };
      
      if (actions[e.key] && document.activeElement !== $('#search')) actions[e.key]();
      
      if (/^[1-5]$/.test(e.key) && document.activeElement !== $('#search')) { 
        e.preventDefault(); 
        const section = state.sections[e.key - 1];
        if (section) selectSection(section);
      }
    };

    // Initialize - Staggered loading for smooth UX
    const init = () => {
      setTheme(store.get('theme', window.matchMedia('(prefers-color-scheme: dark)').matches));
      $('#density').value = state.density;
      $('#private').checked = state.private;
      
      setTimeout(loadQuote, 100);
      setTimeout(() => { renderChips(); loadNews(); }, 200);
      setTimeout(loadWeather, 300);
      setTimeout(loadTradingView, 400);
    };

    init();
  </script>
</body>
</html>
